<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Progress Tracker</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Advanced productivity app with Focus Mode, Dependencies, Time Blocking, and AI-powered insights">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TaskTracker">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 min-h-screen p-6 transition-colors duration-300">
    <div class="max-w-7xl mx-auto">
        <!-- Header with Initials -->
        <div class="flex justify-between items-center mb-4">
            <div class="flex gap-3">
                <button onclick="showFocusMode()" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-2 rounded-full shadow-lg hover:shadow-xl transition flex items-center gap-2 font-bold">
                    üéØ FOCUS MODE
                </button>
                <button onclick="showDependencyView()" class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-full shadow-lg hover:shadow-xl transition flex items-center gap-2">
                    üîó Dependencies
                </button>
                <button onclick="showTimeBoxing()" class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-full shadow-lg hover:shadow-xl transition flex items-center gap-2">
                    ‚è∞ Time Block
                </button>
            </div>
            <div class="flex items-center gap-3">
                <!-- Dark Mode Toggle -->
                <button onclick="toggleDarkMode()" id="dark-mode-toggle" class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 p-3 rounded-full shadow-lg hover:shadow-xl transition">
                    <svg id="sun-icon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    <svg id="moon-icon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                    </svg>
                </button>
                
                <!-- Feature Menu Button -->
                <button onclick="toggleFeatureMenu()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-3 rounded-full shadow-lg hover:shadow-xl transition relative">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                    <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">15</span>
                </button>
                
                <button onclick="showNotificationSettings()" class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-full shadow-lg hover:shadow-xl transition flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    <span id="notification-status" class="text-sm font-medium">Notifications</span>
                </button>
                <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white w-14 h-14 rounded-full flex items-center justify-center text-xl font-bold shadow-lg cursor-pointer hover:scale-110 transition-transform" onclick="editInitials()" title="Click to edit initials">
                    <span id="user-initials">N</span>
                </div>
            </div>
        </div>

        <!-- Main Container -->
        <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl p-8 mb-6 transition-colors duration-300">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- TO-DO LIST Section -->
                <div>
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="text-3xl font-bold text-gray-800 dark:text-white">
                            TO-DO LIST
                            <span id="view-indicator" class="text-sm font-normal text-gray-500 dark:text-gray-400 ml-2"></span>
                        </h1>
                        <button onclick="showAddTaskModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition">
                            + Add Task
                        </button>
                    </div>
                    
                    <div id="tasks-list" class="space-y-3">
                        <!-- Tasks will be rendered here -->
                    </div>
                </div>

                <!-- TASK PROGRESS Section -->
                <div>
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-6">TASK PROGRESS</h2>
                    
                    <!-- Progress Chart -->
                    <div class="mb-6 flex justify-center">
                        <div class="w-80 h-80">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>

                    <!-- Today's Date -->
                    <div class="flex items-center justify-center gap-2 text-gray-600 mb-4">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <span id="current-date" class="font-medium">TODAY: FEB 4, 2026</span>
                    </div>

                    <!-- View Toggle -->
                    <div class="flex justify-center gap-2 mb-4">
                        <button onclick="setView('today')" id="btn-today" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium">Today</button>
                        <button onclick="setView('week')" id="btn-week" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium">Week</button>
                        <button onclick="setView('month')" id="btn-month" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium">Month</button>
                    </div>

                    <!-- Stats -->
                    <div id="stats" class="grid grid-cols-3 gap-4 text-center">
                        <!-- Stats will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Weekly/Monthly Analytics -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Completion Trend -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">üìà Completion Trend</h3>
                <canvas id="trendChart"></canvas>
            </div>

            <!-- Category Breakdown -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">üìä Priority Distribution</h3>
                <canvas id="priorityChart"></canvas>
            </div>
        </div>

        <!-- Procrastination Heatmap -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-bold text-gray-800">üî• Procrastination Heatmap</h3>
                <button onclick="analyzeProcrastination()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
                    Analyze My Patterns
                </button>
            </div>
            <div id="procrastination-heatmap">
                <p class="text-gray-500 text-center py-8">Click "Analyze My Patterns" to see which tasks you keep rescheduling</p>
            </div>
        </div>

        <!-- Weekly Progress by Area -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6">
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">üìÖ Weekly Progress by Area</h3>
            <div id="weekly-progress-container">
                <!-- Weekly progress will be rendered here -->
            </div>
        </div>

        <!-- AI Feedback Section -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-bold text-gray-800">ü§ñ AI Productivity Insights</h3>
                <button onclick="getAIFeedback()" id="ai-btn" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg hover:from-purple-600 hover:to-pink-600 font-medium transition">
                    Get AI Feedback
                </button>
            </div>
            <div id="ai-feedback" class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg hidden"></div>
        </div>

        <!-- Calendar View -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">üìÖ Calendar View</h3>
                <div class="flex gap-2 items-center">
                    <button onclick="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-lg transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <span id="calendar-month" class="text-xl font-semibold px-4"></span>
                    <button onclick="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-lg transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                    <button onclick="goToToday()" class="ml-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                        Today
                    </button>
                </div>
            </div>
            
            <!-- Calendar Grid -->
            <div class="grid grid-cols-7 gap-2">
                <!-- Day headers -->
                <div class="text-center font-bold text-gray-600 p-2">Sun</div>
                <div class="text-center font-bold text-gray-600 p-2">Mon</div>
                <div class="text-center font-bold text-gray-600 p-2">Tue</div>
                <div class="text-center font-bold text-gray-600 p-2">Wed</div>
                <div class="text-center font-bold text-gray-600 p-2">Thu</div>
                <div class="text-center font-bold text-gray-600 p-2">Fri</div>
                <div class="text-center font-bold text-gray-600 p-2">Sat</div>
                
                <!-- Calendar days -->
                <div id="calendar-days"></div>
            </div>

            <!-- Selected Date Info -->
            <div id="selected-date-info" class="mt-6 p-4 bg-blue-50 rounded-lg hidden">
                <h4 class="font-bold text-lg mb-3" id="selected-date-title"></h4>
                <div id="selected-date-tasks" class="space-y-2"></div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center py-6">
            <p class="text-sm text-gray-500 dark:text-gray-400">Made by Navsurya</p>
        </div>
    </div>

    <!-- Feature Menu Modal -->
    <div id="featureMenuModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold">‚ú® Feature Guide</h2>
                    <p class="text-purple-100">Explore all 15+ powerful features</p>
                </div>
                <button onclick="toggleFeatureMenu()" class="text-white hover:text-gray-200 transition">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Features Grid -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-100px)]">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    
                    <!-- Feature Card -->
                    <div class="bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900 dark:to-red-900 p-5 rounded-xl border-2 border-orange-200 dark:border-orange-700 hover:shadow-lg transition cursor-pointer" onclick="showFocusMode(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üéØ</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Focus Mode</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Work on ONE task with 25-min Pomodoro timer. Zero distractions!</p>
                                <span class="inline-block bg-orange-500 text-white text-xs px-3 py-1 rounded-full">Click to Try</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900 dark:to-cyan-900 p-5 rounded-xl border-2 border-blue-200 dark:border-blue-700 hover:shadow-lg transition cursor-pointer" onclick="showDependencyView(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üîó</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Task Dependencies</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Link tasks that depend on each other. Keeps your list logical!</p>
                                <span class="inline-block bg-blue-500 text-white text-xs px-3 py-1 rounded-full">Click to Setup</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900 dark:to-pink-900 p-5 rounded-xl border-2 border-purple-200 dark:border-purple-700 hover:shadow-lg transition cursor-pointer" onclick="showTimeBoxing(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">‚è∞</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Time Blocking</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Drag tasks onto your calendar. See if you actually have time!</p>
                                <span class="inline-block bg-purple-500 text-white text-xs px-3 py-1 rounded-full">Click to Schedule</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900 dark:to-orange-900 p-5 rounded-xl border-2 border-red-200 dark:border-red-700 hover:shadow-lg transition cursor-pointer" onclick="analyzeProcrastination(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üî•</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Procrastination Heatmap</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">AI analyzes tasks you keep rescheduling. Get personalized coaching!</p>
                                <span class="inline-block bg-red-500 text-white text-xs px-3 py-1 rounded-full">Click to Analyze</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900 dark:to-blue-900 p-5 rounded-xl border-2 border-indigo-200 dark:border-indigo-700 hover:shadow-lg transition cursor-pointer" onclick="showEODReview(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üåô</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">End-of-Day Review</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Auto-cleanup at 11 PM. Reschedule, archive, or delete incomplete tasks.</p>
                                <span class="inline-block bg-indigo-500 text-white text-xs px-3 py-1 rounded-full">Click to Review</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900 dark:to-emerald-900 p-5 rounded-xl border-2 border-green-200 dark:border-green-700 hover:shadow-lg transition cursor-pointer" onclick="showAddTaskModal(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üìÅ</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Areas & Subsections</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Organize tasks by life areas (Work, Personal, etc.) with subsections.</p>
                                <span class="inline-block bg-green-500 text-white text-xs px-3 py-1 rounded-full">Click to Create</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-yellow-900 dark:to-amber-900 p-5 rounded-xl border-2 border-yellow-200 dark:border-yellow-700 hover:shadow-lg transition">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üìÖ</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Interactive Calendar</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Click any date to filter tasks. See completion indicators on each day.</p>
                                <span class="inline-block bg-yellow-600 text-white text-xs px-3 py-1 rounded-full">Scroll Down</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-900 dark:to-rose-900 p-5 rounded-xl border-2 border-pink-200 dark:border-pink-700 hover:shadow-lg transition cursor-pointer" onclick="getAIFeedback(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">ü§ñ</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">AI Insights</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Get personalized productivity feedback and recommendations from AI.</p>
                                <span class="inline-block bg-pink-500 text-white text-xs px-3 py-1 rounded-full">Click to Analyze</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-cyan-50 to-teal-50 dark:from-cyan-900 dark:to-teal-900 p-5 rounded-xl border-2 border-cyan-200 dark:border-cyan-700 hover:shadow-lg transition cursor-pointer" onclick="showNotificationSettings(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üîî</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Smart Notifications</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Set custom frequency (minutes/hours). Get reminders for pending tasks.</p>
                                <span class="inline-block bg-cyan-500 text-white text-xs px-3 py-1 rounded-full">Click to Configure</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-violet-50 to-purple-50 dark:from-violet-900 dark:to-purple-900 p-5 rounded-xl border-2 border-violet-200 dark:border-violet-700 hover:shadow-lg transition">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üìä</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Charts & Analytics</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Donut, Line, Pie, and Bar charts. Track completion trends over time.</p>
                                <span class="inline-block bg-violet-500 text-white text-xs px-3 py-1 rounded-full">Always Visible</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-lime-50 to-green-50 dark:from-lime-900 dark:to-green-900 p-5 rounded-xl border-2 border-lime-200 dark:border-lime-700 hover:shadow-lg transition">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üìà</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Weekly Progress</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">See progress by area with subsection breakdown. Visual progress bars!</p>
                                <span class="inline-block bg-lime-600 text-white text-xs px-3 py-1 rounded-full">Scroll Down</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-sky-50 to-blue-50 dark:from-sky-900 dark:to-blue-900 p-5 rounded-xl border-2 border-sky-200 dark:border-sky-700 hover:shadow-lg transition cursor-pointer" onclick="setView('today'); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üëÅÔ∏è</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">View Modes</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Toggle between Today, Week, and Month views for filtered task lists.</p>
                                <span class="inline-block bg-sky-500 text-white text-xs px-3 py-1 rounded-full">Top of Page</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-fuchsia-50 to-pink-50 dark:from-fuchsia-900 dark:to-pink-900 p-5 rounded-xl border-2 border-fuchsia-200 dark:border-fuchsia-700 hover:shadow-lg transition cursor-pointer" onclick="toggleDarkMode(); toggleFeatureMenu();">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üåì</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Dark Mode</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Easy on the eyes! Toggle between light and dark themes instantly.</p>
                                <span class="inline-block bg-fuchsia-500 text-white text-xs px-3 py-1 rounded-full">Click to Toggle</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-900 dark:to-orange-900 p-5 rounded-xl border-2 border-amber-200 dark:border-amber-700 hover:shadow-lg transition">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üíæ</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">100% Private</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">All data stored locally. No servers, no uploads. Works offline!</p>
                                <span class="inline-block bg-amber-600 text-white text-xs px-3 py-1 rounded-full">Always Active</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-rose-50 to-red-50 dark:from-rose-900 dark:to-red-900 p-5 rounded-xl border-2 border-rose-200 dark:border-rose-700 hover:shadow-lg transition">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">üé®</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Color Coding</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">6 colors for areas, 3 priority levels. Visual organization at a glance!</p>
                                <span class="inline-block bg-rose-500 text-white text-xs px-3 py-1 rounded-full">In Task Form</span>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Quick Tips -->
                <div class="mt-8 bg-gradient-to-r from-blue-500 to-purple-500 text-white p-6 rounded-xl">
                    <h3 class="text-2xl font-bold mb-3">üí° Pro Tips</h3>
                    <ul class="space-y-2 text-sm">
                        <li>‚úÖ Start with <strong>Focus Mode</strong> to beat procrastination immediately</li>
                        <li>üîó Use <strong>Dependencies</strong> for projects with multiple steps</li>
                        <li>‚è∞ <strong>Time Block</strong> your day to see realistic workload</li>
                        <li>üî• Check <strong>Procrastination Heatmap</strong> weekly to identify patterns</li>
                        <li>üåô Let <strong>Auto-Shred</strong> clean your list every night at 11 PM</li>
                        <li>ü§ñ Use <strong>AI Insights</strong> for personalized productivity coaching</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Focus Mode Modal -->
    <div id="focusModeModal" class="hidden fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50">
        <div class="text-center max-w-2xl mx-4">
            <div class="mb-8">
                <h1 class="text-6xl font-bold text-white mb-4" id="focus-task-name">Loading...</h1>
                <p class="text-2xl text-gray-300 mb-2" id="focus-task-area"></p>
                <span class="inline-block px-6 py-2 rounded-full text-white text-xl font-bold" id="focus-task-priority"></span>
            </div>

            <!-- Pomodoro Timer -->
            <div class="mb-12">
                <div class="text-8xl font-bold text-white mb-6" id="pomodoro-timer">25:00</div>
                <div class="flex justify-center gap-4">
                    <button onclick="startPomodoro()" id="start-pomodoro" class="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-xl text-xl font-bold transition">
                        ‚ñ∂ Start
                    </button>
                    <button onclick="pausePomodoro()" id="pause-pomodoro" class="hidden bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-4 rounded-xl text-xl font-bold transition">
                        ‚è∏ Pause
                    </button>
                    <button onclick="resetPomodoro()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-4 rounded-xl text-xl font-bold transition">
                        üîÑ Reset
                    </button>
                </div>
            </div>

            <div class="flex justify-center gap-4">
                <button onclick="completeFocusTask()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg text-lg font-medium transition">
                    ‚úÖ Mark Complete
                </button>
                <button onclick="skipFocusTask()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg text-lg font-medium transition">
                    ‚è≠ Skip to Next
                </button>
                <button onclick="exitFocusMode()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg text-lg font-medium transition">
                    ‚ùå Exit Focus Mode
                </button>
            </div>
        </div>
    </div>

    <!-- Time Boxing Modal -->
    <div id="timeBoxingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-2xl font-bold">‚è∞ Time Blocking - Drag Tasks to Calendar</h2>
                <button onclick="hideTimeBoxing()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="grid grid-cols-2 divide-x max-h-[70vh] overflow-y-auto">
                <!-- Left: Task List -->
                <div class="p-6">
                    <h3 class="font-bold text-lg mb-4">üìã Unscheduled Tasks</h3>
                    <div id="timebox-tasks" class="space-y-2"></div>
                </div>
                <!-- Right: Calendar -->
                <div class="p-6">
                    <h3 class="font-bold text-lg mb-4">üìÖ Today's Schedule</h3>
                    <div id="timebox-calendar" class="space-y-1"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dependencies Modal -->
    <div id="dependencyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-8 max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">üîó Task Dependencies</h2>
                <button onclick="hideDependencyView()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <p class="text-gray-600 mb-4">Link tasks that depend on each other. Dependent tasks will be hidden until prerequisites are completed.</p>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold mb-2">This task:</label>
                        <select id="dependent-task" class="w-full border rounded-lg p-2">
                            <option value="">Select task</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Depends on:</label>
                        <select id="prerequisite-task" class="w-full border rounded-lg p-2">
                            <option value="">Select prerequisite</option>
                        </select>
                    </div>
                </div>
                <button onclick="addDependency()" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                    Add Dependency
                </button>
            </div>

            <div id="dependency-list" class="space-y-2"></div>
        </div>
    </div>

    <!-- End of Day Review Modal -->
    <div id="eodReviewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4">
            <h2 class="text-3xl font-bold mb-4">üåô End of Day Review</h2>
            <p class="text-gray-600 mb-6">You didn't complete these tasks today. What would you like to do with them?</p>
            
            <div id="eod-tasks-list" class="space-y-4 mb-6 max-h-96 overflow-y-auto"></div>

            <div class="flex gap-3">
                <button onclick="applyEODDecisions()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition font-medium">
                    Apply Decisions
                </button>
                <button onclick="hideEODReview()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 transition font-medium">
                    Skip for Now
                </button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6">Add New Task</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Task Name</label>
                    <input type="text" id="task-name" placeholder="e.g., Complete project report" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Area / Category</label>
                    <div class="flex gap-2">
                        <select id="task-area" class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="handleAreaChange()">
                            <option value="">Select area</option>
                        </select>
                        <button onclick="showAddAreaModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 rounded-lg">+</button>
                    </div>
                </div>

                <div id="subsection-container" class="hidden">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Subsection (Optional)</label>
                    <div class="flex gap-2">
                        <select id="task-subsection" class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">No subsection</option>
                        </select>
                        <button onclick="showAddSubsectionModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 rounded-lg">+</button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Priority</label>
                    <select id="task-priority" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="LOW">Low Priority</option>
                        <option value="MEDIUM">Medium Priority</option>
                        <option value="HIGH">High Priority</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                    <input type="date" id="task-date" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <div class="flex gap-3">
                    <button onclick="addTask()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition">
                        Add Task
                    </button>
                    <button onclick="hideAddTaskModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 rounded-lg font-medium transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Area Modal -->
    <div id="addAreaModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-6">Add New Area</h2>
            <div class="space-y-4">
                <input type="text" id="area-name" placeholder="e.g., Work, Personal, Health" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Color</label>
                    <div class="grid grid-cols-6 gap-2">
                        <button onclick="selectAreaColor('#3b82f6')" class="w-10 h-10 rounded-full bg-blue-500 border-2 border-transparent hover:border-gray-800"></button>
                        <button onclick="selectAreaColor('#10b981')" class="w-10 h-10 rounded-full bg-green-500 border-2 border-transparent hover:border-gray-800"></button>
                        <button onclick="selectAreaColor('#f59e0b')" class="w-10 h-10 rounded-full bg-orange-500 border-2 border-transparent hover:border-gray-800"></button>
                        <button onclick="selectAreaColor('#ef4444')" class="w-10 h-10 rounded-full bg-red-500 border-2 border-transparent hover:border-gray-800"></button>
                        <button onclick="selectAreaColor('#8b5cf6')" class="w-10 h-10 rounded-full bg-purple-500 border-2 border-transparent hover:border-gray-800"></button>
                        <button onclick="selectAreaColor('#ec4899')" class="w-10 h-10 rounded-full bg-pink-500 border-2 border-transparent hover:border-gray-800"></button>
                    </div>
                    <input type="hidden" id="selected-area-color" value="#3b82f6">
                </div>
                <div class="flex gap-3">
                    <button onclick="addArea()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition">
                        Add Area
                    </button>
                    <button onclick="hideAddAreaModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 rounded-lg font-medium transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Subsection Modal -->
    <div id="addSubsectionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-6">Add Subsection</h2>
            <div class="space-y-4">
                <input type="text" id="subsection-name" placeholder="e.g., Planning, Execution, Review" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <div class="flex gap-3">
                    <button onclick="addSubsection()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition">
                        Add Subsection
                    </button>
                    <button onclick="hideAddSubsectionModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 rounded-lg font-medium transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Settings Modal -->
    <div id="notificationModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-6">üîî Notification Settings</h2>
            
            <div class="space-y-6">
                <!-- Enable/Disable Notifications -->
                <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg">
                    <div>
                        <p class="font-semibold text-gray-800">Enable Notifications</p>
                        <p class="text-sm text-gray-600">Get reminders about pending tasks</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="notification-toggle" class="sr-only peer" onchange="toggleNotifications()">
                        <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                    </label>
                </div>

                <!-- Notification Frequency -->
                <div id="notification-frequency-section" class="hidden">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Notification Frequency</label>
                    <div class="flex gap-3">
                        <input type="number" id="notification-interval" min="1" max="1440" value="30" class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <select id="notification-unit" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="minutes">Minutes</option>
                            <option value="hours">Hours</option>
                        </select>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">You'll receive reminders every <span id="frequency-display">30 minutes</span></p>
                </div>

                <!-- Notification Type -->
                <div id="notification-type-section" class="hidden">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Notification Type</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="notification-type" value="pending" checked class="mr-3">
                            <div>
                                <p class="font-medium">Pending Tasks Only</p>
                                <p class="text-xs text-gray-600">Notify about incomplete tasks</p>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="notification-type" value="all" class="mr-3">
                            <div>
                                <p class="font-medium">All Tasks</p>
                                <p class="text-xs text-gray-600">Notify about all today's tasks</p>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="notification-type" value="high" class="mr-3">
                            <div>
                                <p class="font-medium">High Priority Only</p>
                                <p class="text-xs text-gray-600">Notify about high priority tasks</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Notification Preview -->
                <div id="notification-preview" class="hidden p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border-l-4 border-blue-500">
                    <p class="text-sm font-semibold text-gray-800 dark:text-white mb-1">üìã Task Reminder</p>
                    <p class="text-sm text-gray-600">You have <strong>5 pending tasks</strong> today!</p>
                </div>

                <!-- Buttons -->
                <div class="flex gap-3">
                    <button onclick="saveNotificationSettings()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition">
                        Save Settings
                    </button>
                    <button onclick="hideNotificationSettings()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 rounded-lg font-medium transition">
                        Cancel
                    </button>
                </div>

                <!-- Test Notification -->
                <button onclick="sendTestNotification()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 rounded-lg font-medium transition text-sm">
                    üîî Send Test Notification
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize
        let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
        let areas = JSON.parse(localStorage.getItem('areas') || '[]');
        let subsections = JSON.parse(localStorage.getItem('subsections') || '{}'); // Format: { areaId: ['subsection1', 'subsection2'] }
        let dependencies = JSON.parse(localStorage.getItem('dependencies') || '[]'); // Format: [{dependentId, prerequisiteId}]
        let taskHistory = JSON.parse(localStorage.getItem('taskHistory') || '{}'); // Track task modifications
        let timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '{}'); // Format: {taskId: {start, end}}
        let currentView = 'today';
        let progressChart, trendChart, priorityChart;
        let currentCalendarMonth = new Date();
        let selectedDate = null;
        let notificationInterval = null;
        let notificationSettings = JSON.parse(localStorage.getItem('notificationSettings') || '{"enabled": false, "interval": 30, "unit": "minutes", "type": "pending"}');
        let selectedAreaColor = '#3b82f6';
        let pomodoroInterval = null;
        let pomodoroSeconds = 25 * 60;
        let currentFocusTask = null;
        let darkMode = localStorage.getItem('darkMode') === 'true';

        // Load user initials
        const savedInitials = localStorage.getItem('userInitials') || 'N';
        document.getElementById('user-initials').textContent = savedInitials;

        // DARK MODE FUNCTIONS
        function initDarkMode() {
            if (darkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);
            
            if (darkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            
            // Update charts for dark mode
            updateChartsTheme();
        }

        function updateChartsTheme() {
            const textColor = darkMode ? '#e5e7eb' : '#374151';
            const gridColor = darkMode ? '#374151' : '#e5e7eb';
            
            // Update all charts
            if (progressChart) {
                progressChart.options.plugins.legend.labels.color = textColor;
                progressChart.update();
            }
            if (trendChart) {
                trendChart.options.scales.x.ticks.color = textColor;
                trendChart.options.scales.y.ticks.color = textColor;
                trendChart.options.scales.x.grid.color = gridColor;
                trendChart.options.scales.y.grid.color = gridColor;
                trendChart.update();
            }
            if (priorityChart) {
                priorityChart.options.scales.x.ticks.color = textColor;
                priorityChart.options.scales.y.ticks.color = textColor;
                priorityChart.options.scales.x.grid.color = gridColor;
                priorityChart.options.scales.y.grid.color = gridColor;
                priorityChart.update();
            }
        }

        // FEATURE MENU FUNCTIONS
        function toggleFeatureMenu() {
            const modal = document.getElementById('featureMenuModal');
            modal.classList.toggle('hidden');
        }

        // Initialize dark mode on load
        initDarkMode();

        // FOCUS MODE FUNCTIONS
        function showFocusMode() {
            const today = new Date().toISOString().split('T')[0];
            const availableTasks = getAvailableTasksWithDependencies(tasks.filter(t => t.date === today && !t.completed));
            
            if (availableTasks.length === 0) {
                alert('üéâ No pending tasks for today! Great job!');
                return;
            }

            // Get highest priority task
            const priorityOrder = { HIGH: 3, MEDIUM: 2, LOW: 1 };
            const focusTask = availableTasks.sort((a, b) => priorityOrder[b.priority] - priorityOrder[a.priority])[0];
            
            currentFocusTask = focusTask;
            document.getElementById('focus-task-name').textContent = focusTask.name;
            
            const area = focusTask.areaId ? areas.find(a => a.id === focusTask.areaId) : null;
            document.getElementById('focus-task-area').textContent = area ? `üìÅ ${area.name}` : '';
            
            const priorityEl = document.getElementById('focus-task-priority');
            priorityEl.textContent = focusTask.priority + ' PRIORITY';
            priorityEl.className = `inline-block px-6 py-2 rounded-full text-white text-xl font-bold ${getPriorityColor(focusTask.priority)}`;
            
            resetPomodoro();
            document.getElementById('focusModeModal').classList.remove('hidden');
        }

        function exitFocusMode() {
            if (pomodoroInterval) clearInterval(pomodoroInterval);
            document.getElementById('focusModeModal').classList.add('hidden');
            currentFocusTask = null;
        }

        function completeFocusTask() {
            if (currentFocusTask) {
                toggleTask(currentFocusTask.id);
                exitFocusMode();
                // Show next task
                setTimeout(() => showFocusMode(), 500);
            }
        }

        function skipFocusTask() {
            exitFocusMode();
            setTimeout(() => showFocusMode(), 500);
        }

        // POMODORO TIMER
        function startPomodoro() {
            document.getElementById('start-pomodoro').classList.add('hidden');
            document.getElementById('pause-pomodoro').classList.remove('hidden');
            
            pomodoroInterval = setInterval(() => {
                pomodoroSeconds--;
                updatePomodoroDisplay();
                
                if (pomodoroSeconds <= 0) {
                    clearInterval(pomodoroInterval);
                    playNotificationSound();
                    alert('üéâ Pomodoro Complete! Take a 5-minute break.');
                    resetPomodoro();
                }
            }, 1000);
        }

        function pausePomodoro() {
            clearInterval(pomodoroInterval);
            document.getElementById('start-pomodoro').classList.remove('hidden');
            document.getElementById('pause-pomodoro').classList.add('hidden');
        }

        function resetPomodoro() {
            clearInterval(pomodoroInterval);
            pomodoroSeconds = 25 * 60;
            updatePomodoroDisplay();
            document.getElementById('start-pomodoro').classList.remove('hidden');
            document.getElementById('pause-pomodoro').classList.add('hidden');
        }

        function updatePomodoroDisplay() {
            const mins = Math.floor(pomodoroSeconds / 60);
            const secs = pomodoroSeconds % 60;
            document.getElementById('pomodoro-timer').textContent = 
                `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function playNotificationSound() {
            // Browser notification
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('üéâ Pomodoro Complete!', {
                    body: 'Great work! Time for a 5-minute break.',
                });
            }
        }

        // DEPENDENCY FUNCTIONS
        function showDependencyView() {
            updateDependencyDropdowns();
            renderDependencyList();
            document.getElementById('dependencyModal').classList.remove('hidden');
        }

        function hideDependencyView() {
            document.getElementById('dependencyModal').classList.add('hidden');
        }

        function updateDependencyDropdowns() {
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = tasks.filter(t => t.date === today);
            
            const options = todayTasks.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            document.getElementById('dependent-task').innerHTML = '<option value="">Select task</option>' + options;
            document.getElementById('prerequisite-task').innerHTML = '<option value="">Select prerequisite</option>' + options;
        }

        function addDependency() {
            const dependentId = parseInt(document.getElementById('dependent-task').value);
            const prerequisiteId = parseInt(document.getElementById('prerequisite-task').value);
            
            if (!dependentId || !prerequisiteId) {
                alert('Please select both tasks');
                return;
            }
            
            if (dependentId === prerequisiteId) {
                alert('A task cannot depend on itself');
                return;
            }
            
            // Check for circular dependencies
            if (wouldCreateCircularDependency(dependentId, prerequisiteId)) {
                alert('This would create a circular dependency!');
                return;
            }
            
            dependencies.push({ dependentId, prerequisiteId });
            localStorage.setItem('dependencies', JSON.stringify(dependencies));
            renderDependencyList();
            render();
        }

        function wouldCreateCircularDependency(dependentId, prerequisiteId) {
            // Check if prerequisite depends on dependent (directly or indirectly)
            const checkChain = (taskId, targetId, visited = new Set()) => {
                if (visited.has(taskId)) return false;
                visited.add(taskId);
                
                const deps = dependencies.filter(d => d.dependentId === taskId);
                for (let dep of deps) {
                    if (dep.prerequisiteId === targetId) return true;
                    if (checkChain(dep.prerequisiteId, targetId, visited)) return true;
                }
                return false;
            };
            
            return checkChain(prerequisiteId, dependentId);
        }

        function renderDependencyList() {
            const container = document.getElementById('dependency-list');
            if (dependencies.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No dependencies set</p>';
                return;
            }
            
            container.innerHTML = dependencies.map((dep, index) => {
                const dependent = tasks.find(t => t.id === dep.dependentId);
                const prerequisite = tasks.find(t => t.id === dep.prerequisiteId);
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex-1">
                            <span class="font-medium">${dependent?.name || 'Unknown'}</span>
                            <span class="text-gray-500 mx-2">depends on</span>
                            <span class="font-medium text-blue-600">${prerequisite?.name || 'Unknown'}</span>
                        </div>
                        <button onclick="removeDependency(${index})" class="text-red-500 hover:text-red-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                `;
            }).join('');
        }

        function removeDependency(index) {
            dependencies.splice(index, 1);
            localStorage.setItem('dependencies', JSON.stringify(dependencies));
            renderDependencyList();
            render();
        }

        function getAvailableTasksWithDependencies(taskList) {
            return taskList.filter(task => {
                const deps = dependencies.filter(d => d.dependentId === task.id);
                if (deps.length === 0) return true;
                
                // Check if all prerequisites are completed
                return deps.every(dep => {
                    const prereq = tasks.find(t => t.id === dep.prerequisiteId);
                    return prereq && prereq.completed;
                });
            });
        }

        // TIME BOXING FUNCTIONS
        function showTimeBoxing() {
            renderTimeBoxingView();
            document.getElementById('timeBoxingModal').classList.remove('hidden');
        }

        function hideTimeBoxing() {
            document.getElementById('timeBoxingModal').classList.add('hidden');
        }

        function renderTimeBoxingView() {
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = tasks.filter(t => t.date === today && !t.completed);
            const unscheduledTasks = todayTasks.filter(t => !timeBlocks[t.id]);
            
            // Render unscheduled tasks
            const tasksContainer = document.getElementById('timebox-tasks');
            tasksContainer.innerHTML = unscheduledTasks.length > 0 ? unscheduledTasks.map(task => {
                const area = task.areaId ? areas.find(a => a.id === task.areaId) : null;
                return `
                    <div class="p-3 bg-white border-2 rounded-lg cursor-move hover:shadow-lg transition" draggable="true" ondragstart="dragTask(event, ${task.id})">
                        <div class="font-medium">${task.name}</div>
                        <div class="text-sm text-gray-600 mt-1">
                            ${area ? `<span class="text-xs px-2 py-1 rounded" style="background: ${area.color}22; color: ${area.color}">${area.name}</span>` : ''}
                            <span class="ml-2 px-2 py-1 rounded text-white text-xs ${getPriorityColor(task.priority)}">${task.priority}</span>
                        </div>
                    </div>
                `;
            }).join('') : '<p class="text-gray-500 text-center py-4">All tasks scheduled!</p>';
            
            // Render 24-hour calendar
            const calendarContainer = document.getElementById('timebox-calendar');
            const hours = Array.from({length: 24}, (_, i) => i);
            calendarContainer.innerHTML = hours.map(hour => {
                const hourStr = `${String(hour).padStart(2, '0')}:00`;
                const blocksInHour = Object.entries(timeBlocks).filter(([taskId, block]) => {
                    return block.start.startsWith(String(hour).padStart(2, '0'));
                });
                
                return `
                    <div class="border rounded p-2 min-h-16 bg-gray-50 hover:bg-gray-100 transition" 
                         ondrop="dropTask(event, '${hourStr}')" 
                         ondragover="allowDrop(event)">
                        <div class="text-xs font-semibold text-gray-600 mb-1">${hourStr}</div>
                        ${blocksInHour.map(([taskId, block]) => {
                            const task = tasks.find(t => t.id === parseInt(taskId));
                            return task ? `
                                <div class="text-sm bg-blue-100 border-l-4 border-blue-500 p-2 rounded mt-1">
                                    <div class="font-medium">${task.name}</div>
                                    <div class="text-xs text-gray-600">${block.start} - ${block.end}</div>
                                    <button onclick="removeTimeBlock(${taskId})" class="text-xs text-red-500 hover:text-red-700">Remove</button>
                                </div>
                            ` : '';
                        }).join('')}
                    </div>
                `;
            }).join('');
        }

        let draggedTaskId = null;

        function dragTask(event, taskId) {
            draggedTaskId = taskId;
            event.dataTransfer.effectAllowed = 'move';
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function dropTask(event, startTime) {
            event.preventDefault();
            if (!draggedTaskId) return;
            
            const duration = prompt('How long will this task take? (in minutes)', '60');
            if (!duration || isNaN(duration)) return;
            
            const [hour, minute] = startTime.split(':').map(Number);
            const endMinutes = minute + parseInt(duration);
            const endHour = hour + Math.floor(endMinutes / 60);
            const endMinute = endMinutes % 60;
            
            timeBlocks[draggedTaskId] = {
                start: startTime,
                end: `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`
            };
            
            localStorage.setItem('timeBlocks', JSON.stringify(timeBlocks));
            draggedTaskId = null;
            renderTimeBoxingView();
        }

        function removeTimeBlock(taskId) {
            delete timeBlocks[taskId];
            localStorage.setItem('timeBlocks', JSON.stringify(timeBlocks));
            renderTimeBoxingView();
        }

        // PROCRASTINATION TRACKING
        function trackTaskModification(taskId, action) {
            if (!taskHistory[taskId]) {
                taskHistory[taskId] = { reschedules: 0, edits: 0, created: new Date().toISOString() };
            }
            
            if (action === 'reschedule') taskHistory[taskId].reschedules++;
            if (action === 'edit') taskHistory[taskId].edits++;
            
            taskHistory[taskId].lastModified = new Date().toISOString();
            localStorage.setItem('taskHistory', JSON.stringify(taskHistory));
        }

        async function analyzeProcrastination() {
            const problematicTasks = Object.entries(taskHistory)
                .filter(([taskId, history]) => history.reschedules >= 3 || history.edits >= 3)
                .map(([taskId, history]) => {
                    const task = tasks.find(t => t.id === parseInt(taskId));
                    return task ? { task, history } : null;
                }).filter(Boolean);
            
            const container = document.getElementById('procrastination-heatmap');
            
            if (problematicTasks.length === 0) {
                container.innerHTML = '<p class="text-green-600 text-center py-8 font-semibold">‚úÖ No procrastination patterns detected! You\'re doing great!</p>';
                return;
            }
            
            // Show analysis
            container.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                        <p class="font-semibold text-red-800">‚ö†Ô∏è Found ${problematicTasks.length} task(s) you keep rescheduling or editing</p>
                    </div>
                    ${problematicTasks.map(({ task, history }) => `
                        <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-lg">${task.name}</h4>
                                <span class="px-3 py-1 rounded-full text-white text-sm ${getPriorityColor(task.priority)}">${task.priority}</span>
                            </div>
                            <div class="text-sm text-gray-700 space-y-1">
                                <p>üìÖ Rescheduled: <strong>${history.reschedules} times</strong></p>
                                <p>‚úèÔ∏è Edited: <strong>${history.edits} times</strong></p>
                            </div>
                            <button onclick="getAICoaching(${task.id})" class="mt-3 bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition text-sm">
                                Get AI Coaching
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function getAICoaching(taskId) {
            const task = tasks.find(t => t.id === taskId);
            const history = taskHistory[taskId];
            
            if (!task) return;
            
            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 500,
                        messages: [{
                            role: "user",
                            content: `I keep procrastinating on this task: "${task.name}"
                            
I've rescheduled it ${history.reschedules} times and edited it ${history.edits} times.

Please give me:
1. Why I might be avoiding this
2. How to break it into smaller sub-tasks (give me 3 specific actionable steps)
3. One motivational tip

Be brief and actionable.`
                        }]
                    })
                });

                const data = await response.json();
                const coaching = data.content.map(item => item.text || '').join('\n');
                
                alert(`ü§ñ AI Coaching for "${task.name}":\n\n${coaching}`);
            } catch (error) {
                alert('Unable to get AI coaching. Please try again.');
            }
        }

        // END OF DAY REVIEW
        function showEODReview() {
            const today = new Date().toISOString().split('T')[0];
            const incompleteTasks = tasks.filter(t => t.date === today && !t.completed);
            
            if (incompleteTasks.length === 0) {
                alert('üéâ All tasks completed! Great job!');
                return;
            }
            
            const container = document.getElementById('eod-tasks-list');
            container.innerHTML = incompleteTasks.map(task => `
                <div class="p-4 bg-gray-50 rounded-lg">
                    <div class="font-medium mb-3">${task.name}</div>
                    <div class="flex gap-2">
                        <button onclick="eodReschedule(${task.id})" class="flex-1 bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 transition text-sm">
                            üìÖ Reschedule Tomorrow
                        </button>
                        <button onclick="eodSomeday(${task.id})" class="flex-1 bg-yellow-500 text-white px-3 py-2 rounded hover:bg-yellow-600 transition text-sm">
                            üìÇ Move to Someday
                        </button>
                        <button onclick="eodDelete(${task.id})" class="flex-1 bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600 transition text-sm">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                    <input type="hidden" id="eod-decision-${task.id}" value="">
                </div>
            `).join('');
            
            document.getElementById('eodReviewModal').classList.remove('hidden');
        }

        function hideEODReview() {
            document.getElementById('eodReviewModal').classList.add('hidden');
        }

        function eodReschedule(taskId) {
            document.getElementById(`eod-decision-${taskId}`).value = 'reschedule';
            highlightEODButton(taskId, 0);
        }

        function eodSomeday(taskId) {
            document.getElementById(`eod-decision-${taskId}`).value = 'someday';
            highlightEODButton(taskId, 1);
        }

        function eodDelete(taskId) {
            document.getElementById(`eod-decision-${taskId}`).value = 'delete';
            highlightEODButton(taskId, 2);
        }

        function highlightEODButton(taskId, buttonIndex) {
            const container = document.getElementById(`eod-decision-${taskId}`).parentElement;
            const buttons = container.querySelectorAll('button');
            buttons.forEach((btn, i) => {
                btn.style.opacity = i === buttonIndex ? '1' : '0.5';
            });
        }

        function applyEODDecisions() {
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            const incompleteTasks = tasks.filter(t => t.date === today && !t.completed);
            
            incompleteTasks.forEach(task => {
                const decision = document.getElementById(`eod-decision-${task.id}`)?.value;
                
                if (decision === 'reschedule') {
                    task.date = tomorrowStr;
                    trackTaskModification(task.id, 'reschedule');
                } else if (decision === 'someday') {
                    task.date = '9999-12-31'; // Far future date
                    task.someday = true;
                } else if (decision === 'delete') {
                    tasks = tasks.filter(t => t.id !== task.id);
                }
            });
            
            localStorage.setItem('tasks', JSON.stringify(tasks));
            hideEODReview();
            render();
        }

        // Auto-trigger EOD review at 11 PM
        function checkEODTime() {
            const now = new Date();
            if (now.getHours() === 23 && now.getMinutes() === 0) {
                showEODReview();
            }
        }
        
        setInterval(checkEODTime, 60000); // Check every minute

        // Area Management Functions
        function showAddAreaModal() {
            document.getElementById('addAreaModal').classList.remove('hidden');
        }

        function hideAddAreaModal() {
            document.getElementById('addAreaModal').classList.add('hidden');
            document.getElementById('area-name').value = '';
        }

        function selectAreaColor(color) {
            selectedAreaColor = color;
            document.getElementById('selected-area-color').value = color;
        }

        function addArea() {
            const name = document.getElementById('area-name').value.trim();
            if (!name) {
                alert('Please enter an area name');
                return;
            }

            const area = {
                id: Date.now(),
                name: name,
                color: selectedAreaColor
            };

            areas.push(area);
            subsections[area.id] = []; // Initialize empty subsections array
            localStorage.setItem('areas', JSON.stringify(areas));
            localStorage.setItem('subsections', JSON.stringify(subsections));
            
            hideAddAreaModal();
            updateAreaDropdown();
            renderWeeklyProgress();
        }

        function updateAreaDropdown() {
            const areaSelect = document.getElementById('task-area');
            areaSelect.innerHTML = '<option value="">Select area</option>' +
                areas.map(area => `<option value="${area.id}">${area.name}</option>`).join('');
        }

        function handleAreaChange() {
            const selectedAreaId = document.getElementById('task-area').value;
            const subsectionContainer = document.getElementById('subsection-container');
            
            if (selectedAreaId && subsections[selectedAreaId]) {
                subsectionContainer.classList.remove('hidden');
                updateSubsectionDropdown(selectedAreaId);
            } else {
                subsectionContainer.classList.add('hidden');
            }
        }

        function updateSubsectionDropdown(areaId) {
            const subsectionSelect = document.getElementById('task-subsection');
            const areaSubs = subsections[areaId] || [];
            subsectionSelect.innerHTML = '<option value="">No subsection</option>' +
                areaSubs.map(sub => `<option value="${sub}">${sub}</option>`).join('');
        }

        function showAddSubsectionModal() {
            const selectedAreaId = document.getElementById('task-area').value;
            if (!selectedAreaId) {
                alert('Please select an area first');
                return;
            }
            document.getElementById('addSubsectionModal').classList.remove('hidden');
        }

        function hideAddSubsectionModal() {
            document.getElementById('addSubsectionModal').classList.add('hidden');
            document.getElementById('subsection-name').value = '';
        }

        function addSubsection() {
            const selectedAreaId = document.getElementById('task-area').value;
            const name = document.getElementById('subsection-name').value.trim();
            
            if (!name) {
                alert('Please enter a subsection name');
                return;
            }

            if (!subsections[selectedAreaId]) {
                subsections[selectedAreaId] = [];
            }

            if (!subsections[selectedAreaId].includes(name)) {
                subsections[selectedAreaId].push(name);
                localStorage.setItem('subsections', JSON.stringify(subsections));
                updateSubsectionDropdown(selectedAreaId);
            }

            hideAddSubsectionModal();
        }

        function renderWeeklyProgress() {
            const container = document.getElementById('weekly-progress-container');
            
            // Get date range for the week
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay()); // Start of week (Sunday)
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6); // End of week (Saturday)

            // Filter tasks for this week
            const weekTasks = tasks.filter(t => {
                const taskDate = new Date(t.date);
                return taskDate >= weekStart && taskDate <= weekEnd;
            });

            if (areas.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p class="text-lg mb-2">No areas defined yet</p>
                        <p class="text-sm">Create areas to organize your tasks and track weekly progress</p>
                    </div>
                `;
                return;
            }

            // Group tasks by area
            const areaProgress = areas.map(area => {
                const areaTasks = weekTasks.filter(t => t.areaId === area.id);
                const completed = areaTasks.filter(t => t.completed).length;
                const total = areaTasks.length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

                // Group by subsection if available
                const subsectionProgress = {};
                if (subsections[area.id]) {
                    subsections[area.id].forEach(sub => {
                        const subTasks = areaTasks.filter(t => t.subsection === sub);
                        const subCompleted = subTasks.filter(t => t.completed).length;
                        subsectionProgress[sub] = {
                            completed: subCompleted,
                            total: subTasks.length,
                            percentage: subTasks.length > 0 ? Math.round((subCompleted / subTasks.length) * 100) : 0
                        };
                    });
                }

                return { area, completed, total, percentage, subsectionProgress };
            });

            container.innerHTML = areaProgress.map(({ area, completed, total, percentage, subsectionProgress }) => `
                <div class="mb-6 p-6 border-l-4 rounded-lg bg-gray-50" style="border-color: ${area.color}">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-4 h-4 rounded-full" style="background: ${area.color}"></div>
                            <h4 class="text-lg font-bold text-gray-800">${area.name}</h4>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold" style="color: ${area.color}">${percentage}%</p>
                            <p class="text-sm text-gray-600">${completed}/${total} tasks</p>
                        </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                        <div class="h-3 rounded-full transition-all" style="width: ${percentage}%; background: ${area.color}"></div>
                    </div>

                    <!-- Subsections -->
                    ${Object.keys(subsectionProgress).length > 0 ? `
                        <div class="mt-4 space-y-2">
                            <p class="text-sm font-semibold text-gray-700 mb-2">Subsections:</p>
                            ${Object.entries(subsectionProgress).map(([name, data]) => `
                                <div class="flex items-center justify-between p-2 bg-white rounded">
                                    <span class="text-sm text-gray-700">üìÅ ${name}</span>
                                    <div class="flex items-center gap-3">
                                        <div class="w-24 bg-gray-200 rounded-full h-2">
                                            <div class="h-2 rounded-full" style="width: ${data.percentage}%; background: ${area.color}"></div>
                                        </div>
                                        <span class="text-sm font-medium text-gray-600">${data.completed}/${data.total}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Request notification permission on load
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Update notification status display
        function updateNotificationStatus() {
            const statusEl = document.getElementById('notification-status');
            if (notificationSettings.enabled) {
                const intervalText = notificationSettings.interval + ' ' + notificationSettings.unit;
                statusEl.textContent = `üîî Every ${intervalText}`;
            } else {
                statusEl.textContent = 'Notifications';
            }
        }

        // Show notification settings modal
        function showNotificationSettings() {
            document.getElementById('notificationModal').classList.remove('hidden');
            document.getElementById('notification-toggle').checked = notificationSettings.enabled;
            document.getElementById('notification-interval').value = notificationSettings.interval;
            document.getElementById('notification-unit').value = notificationSettings.unit;
            
            const radios = document.getElementsByName('notification-type');
            radios.forEach(radio => {
                radio.checked = radio.value === notificationSettings.type;
            });

            updateFrequencyDisplay();
            if (notificationSettings.enabled) {
                document.getElementById('notification-frequency-section').classList.remove('hidden');
                document.getElementById('notification-type-section').classList.remove('hidden');
                document.getElementById('notification-preview').classList.remove('hidden');
            }
        }

        function hideNotificationSettings() {
            document.getElementById('notificationModal').classList.add('hidden');
        }

        function toggleNotifications() {
            const enabled = document.getElementById('notification-toggle').checked;
            document.getElementById('notification-frequency-section').classList.toggle('hidden', !enabled);
            document.getElementById('notification-type-section').classList.toggle('hidden', !enabled);
            document.getElementById('notification-preview').classList.toggle('hidden', !enabled);
        }

        function updateFrequencyDisplay() {
            const interval = document.getElementById('notification-interval').value;
            const unit = document.getElementById('notification-unit').value;
            document.getElementById('frequency-display').textContent = `${interval} ${unit}`;
        }

        // Listen for frequency changes
        document.addEventListener('DOMContentLoaded', function() {
            const intervalInput = document.getElementById('notification-interval');
            const unitSelect = document.getElementById('notification-unit');
            
            if (intervalInput) {
                intervalInput.addEventListener('input', updateFrequencyDisplay);
            }
            if (unitSelect) {
                unitSelect.addEventListener('change', updateFrequencyDisplay);
            }
        });

        function saveNotificationSettings() {
            const enabled = document.getElementById('notification-toggle').checked;
            const interval = parseInt(document.getElementById('notification-interval').value);
            const unit = document.getElementById('notification-unit').value;
            const type = document.querySelector('input[name="notification-type"]:checked').value;

            notificationSettings = { enabled, interval, unit, type };
            localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));

            // Stop existing notifications
            if (notificationInterval) {
                clearInterval(notificationInterval);
                notificationInterval = null;
            }

            // Start new notifications if enabled
            if (enabled) {
                if ('Notification' in window) {
                    if (Notification.permission === 'granted') {
                        startNotifications();
                    } else if (Notification.permission !== 'denied') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                startNotifications();
                            } else {
                                alert('Please enable notifications in your browser settings to receive reminders.');
                            }
                        });
                    } else {
                        alert('Notifications are blocked. Please enable them in your browser settings.');
                    }
                } else {
                    alert('Your browser does not support notifications.');
                }
            }

            updateNotificationStatus();
            hideNotificationSettings();
        }

        function startNotifications() {
            // Convert to milliseconds
            let intervalMs = notificationSettings.interval;
            if (notificationSettings.unit === 'hours') {
                intervalMs *= 60 * 60 * 1000;
            } else {
                intervalMs *= 60 * 1000;
            }

            // Send immediate notification
            sendNotification();

            // Set interval for recurring notifications
            notificationInterval = setInterval(() => {
                sendNotification();
            }, intervalMs);
        }

        function sendNotification() {
            if (!notificationSettings.enabled || Notification.permission !== 'granted') {
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            let todayTasks = tasks.filter(t => t.date === today);

            // Filter based on notification type
            if (notificationSettings.type === 'pending') {
                todayTasks = todayTasks.filter(t => !t.completed);
            } else if (notificationSettings.type === 'high') {
                todayTasks = todayTasks.filter(t => t.priority === 'HIGH' && !t.completed);
            }

            if (todayTasks.length > 0) {
                const completedCount = tasks.filter(t => t.date === today && t.completed).length;
                const totalCount = tasks.filter(t => t.date === today).length;
                
                let title = 'üìã Task Reminder';
                let body = '';

                if (notificationSettings.type === 'pending') {
                    body = `You have ${todayTasks.length} pending task${todayTasks.length > 1 ? 's' : ''} today!`;
                } else if (notificationSettings.type === 'high') {
                    body = `You have ${todayTasks.length} high priority task${todayTasks.length > 1 ? 's' : ''} pending!`;
                } else {
                    body = `Today's progress: ${completedCount}/${totalCount} tasks completed`;
                }

                // Show the first 2 tasks
                if (todayTasks.length > 0) {
                    body += '\n\n‚Ä¢ ' + todayTasks[0].name;
                    if (todayTasks.length > 1) {
                        body += '\n‚Ä¢ ' + todayTasks[1].name;
                    }
                    if (todayTasks.length > 2) {
                        body += `\n...and ${todayTasks.length - 2} more`;
                    }
                }

                const notification = new Notification(title, {
                    body: body,
                    icon: 'üìã',
                    badge: 'üìã',
                    tag: 'task-reminder',
                    requireInteraction: false
                });

                // Focus window when notification is clicked
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
            }
        }

        function sendTestNotification() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('üîî Test Notification', {
                        body: 'Notifications are working! You\'ll receive reminders based on your settings.',
                        icon: 'üìã',
                        tag: 'test-notification'
                    });
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification('üîî Test Notification', {
                                body: 'Notifications are working! You\'ll receive reminders based on your settings.',
                                icon: 'üìã'
                            });
                        }
                    });
                } else {
                    alert('Notifications are blocked. Please enable them in your browser settings.');
                }
            } else {
                alert('Your browser does not support notifications.');
            }
        }

        // Initialize notifications if enabled
        if (notificationSettings.enabled && Notification.permission === 'granted') {
            startNotifications();
        }
        updateNotificationStatus();

        function editInitials() {
            const current = document.getElementById('user-initials').textContent;
            const newInitials = prompt('Enter your initials (2-3 letters):', current);
            if (newInitials && newInitials.trim().length >= 1 && newInitials.trim().length <= 3) {
                const initials = newInitials.trim().toUpperCase();
                document.getElementById('user-initials').textContent = initials;
                localStorage.setItem('userInitials', initials);
            }
        }

        // Calendar Functions
        function changeMonth(direction) {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + direction);
            renderCalendar();
        }

        function goToToday() {
            currentCalendarMonth = new Date();
            renderCalendar();
        }

        function renderCalendar() {
            const year = currentCalendarMonth.getFullYear();
            const month = currentCalendarMonth.getMonth();
            
            // Update month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendar-month').textContent = `${monthNames[month]} ${year}`;

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Get today's date for comparison
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            let calendarHTML = '';

            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += '<div class="p-2"></div>';
            }

            // Calendar days
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];
                const dayTasks = tasks.filter(t => t.date === dateStr);
                const completedTasks = dayTasks.filter(t => t.completed).length;
                const totalTasks = dayTasks.length;
                
                const isToday = dateStr === todayStr;
                const hasSelectedDate = selectedDate === dateStr;
                
                let dayClass = 'p-3 rounded-lg border-2 cursor-pointer transition hover:shadow-lg ';
                
                if (isToday) {
                    dayClass += 'border-blue-500 bg-blue-50 ';
                } else if (hasSelectedDate) {
                    dayClass += 'border-purple-500 bg-purple-50 ';
                } else {
                    dayClass += 'border-gray-200 hover:border-gray-300 ';
                }

                calendarHTML += `
                    <div class="${dayClass}" onclick="selectDate('${dateStr}')">
                        <div class="text-right font-semibold text-gray-700 mb-1">${day}</div>
                        ${totalTasks > 0 ? `
                            <div class="text-xs space-y-1">
                                <div class="flex items-center justify-center gap-1">
                                    <div class="w-2 h-2 rounded-full ${completedTasks === totalTasks ? 'bg-green-500' : completedTasks > 0 ? 'bg-yellow-500' : 'bg-red-500'}"></div>
                                    <span class="text-gray-600">${completedTasks}/${totalTasks}</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            document.getElementById('calendar-days').innerHTML = calendarHTML;
        }

        function selectDate(dateStr) {
            selectedDate = dateStr;
            const date = new Date(dateStr);
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('selected-date-title').textContent = 
                `${monthNames[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
            
            const dayTasks = tasks.filter(t => t.date === dateStr);
            
            if (dayTasks.length > 0) {
                document.getElementById('selected-date-tasks').innerHTML = dayTasks.map(task => `
                    <div class="flex items-center gap-3 p-3 bg-white rounded-lg border ${task.completed ? 'opacity-75' : ''}">
                        <input 
                            type="checkbox" 
                            ${task.completed ? 'checked' : ''} 
                            onchange="toggleTask(${task.id})"
                            class="w-5 h-5 rounded border-gray-300 text-cyan-500 focus:ring-cyan-500 cursor-pointer"
                        >
                        <span class="flex-1 ${task.completed ? 'line-through text-gray-500' : 'text-gray-800'}">${task.name}</span>
                        <span class="px-2 py-1 rounded-full text-white text-xs font-medium ${getPriorityColor(task.priority)}">
                            ${task.priority}
                        </span>
                    </div>
                `).join('');
            } else {
                document.getElementById('selected-date-tasks').innerHTML = 
                    '<p class="text-gray-500 text-center py-4">No tasks for this date</p>';
            }
            
            document.getElementById('selected-date-info').classList.remove('hidden');
            
            // Update the to-do list to show selected date's tasks
            updateToDoListForDate(dateStr);
            
            // Scroll to calendar
            document.getElementById('selected-date-info').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            renderCalendar();
        }

        function updateToDoListForDate(dateStr) {
            const date = new Date(dateStr);
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            const dateDisplay = `${monthNames[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
            
            const dayTasks = tasks.filter(t => t.date === dateStr);
            const tasksList = document.getElementById('tasks-list');
            
            // Add a header showing the selected date
            const header = `
                <div class="bg-blue-100 border-l-4 border-blue-500 p-4 mb-4 rounded">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold text-blue-800">üìÖ Viewing: ${dateDisplay}</p>
                            <p class="text-sm text-blue-600">${dayTasks.length} task(s) for this date</p>
                        </div>
                        <button onclick="clearDateFilter()" class="text-blue-600 hover:text-blue-800 underline text-sm">
                            Show All Tasks
                        </button>
                    </div>
                </div>
            `;
            
            tasksList.innerHTML = header + (dayTasks.length > 0 ? dayTasks.map(task => `
                <div class="flex items-center justify-between p-4 border-2 rounded-xl hover:bg-gray-50 transition ${task.completed ? 'bg-gray-50 opacity-75' : 'bg-white'}">
                    <div class="flex items-center gap-4 flex-1">
                        <input 
                            type="checkbox" 
                            ${task.completed ? 'checked' : ''} 
                            onchange="toggleTask(${task.id})"
                            class="w-6 h-6 rounded border-gray-300 text-cyan-500 focus:ring-cyan-500 cursor-pointer"
                        >
                        <span class="flex-1 text-lg ${task.completed ? 'line-through text-gray-500' : 'text-gray-800'}">${task.name}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="px-3 py-1 rounded-full text-white text-sm font-medium ${getPriorityColor(task.priority)}">
                            ${task.priority}
                        </span>
                        <button onclick="deleteTask(${task.id})" class="text-red-500 hover:text-red-700 p-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('') : `
                <div class="text-center py-12 text-gray-500">
                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                    <p class="text-lg">No tasks for this date</p>
                    <p class="text-sm">Click "Add Task" to create one!</p>
                </div>
            `);

            // Update charts to show only this date's data
            updateChartsForDate(dateStr);
        }

        function clearDateFilter() {
            selectedDate = null;
            document.getElementById('selected-date-info').classList.add('hidden');
            render();
        }

        function updateChartsForDate(dateStr) {
            const dayTasks = tasks.filter(t => t.date === dateStr);
            const completed = dayTasks.filter(t => t.completed).length;
            const total = dayTasks.length;
            const pending = total - completed;
            
            const completedPercent = total > 0 ? Math.round((completed / total) * 100) : 0;
            const pendingPercent = total > 0 ? Math.round((pending / total) * 100) : 0;

            // Update progress chart for specific date
            progressChart.data.datasets[0].data = [completedPercent, 0, pendingPercent];
            progressChart.update();

            // Update stats for specific date
            document.getElementById('stats').innerHTML = `
                <div class="bg-cyan-50 p-4 rounded-lg">
                    <div class="text-3xl font-bold text-cyan-600">${completedPercent}%</div>
                    <div class="text-sm text-gray-600">Completed</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg">
                    <div class="text-3xl font-bold text-red-600">${total}</div>
                    <div class="text-sm text-gray-600">Total Tasks</div>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <div class="text-3xl font-bold text-yellow-600">${pending}</div>
                    <div class="text-sm text-gray-600">Pending</div>
                </div>
            `;

            // Update priority chart for specific date
            const priorityCount = { HIGH: 0, MEDIUM: 0, LOW: 0 };
            dayTasks.forEach(task => {
                priorityCount[task.priority]++;
            });

            priorityChart.data.labels = ['High', 'Medium', 'Low'];
            priorityChart.data.datasets = [{
                data: [priorityCount.HIGH, priorityCount.MEDIUM, priorityCount.LOW],
                backgroundColor: ['#ef4444', '#f59e0b', '#10b981']
            }];
            priorityChart.update();
        }

        // Set current date
        const today = new Date();
        const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
        document.getElementById('current-date').textContent = `TODAY: ${months[today.getMonth()]} ${today.getDate()}, ${today.getFullYear()}`;
        document.getElementById('task-date').valueAsDate = today;

        // Initialize Charts
        const progressCtx = document.getElementById('progressChart').getContext('2d');
        progressChart = new Chart(progressCtx, {
            type: 'doughnut',
            data: {
                labels: ['COMPLETED', 'IN PROGRESS', 'PENDING'],
                datasets: [{
                    data: [45, 30, 25],
                    backgroundColor: ['#06b6d4', '#ef4444', '#fbbf24'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                cutout: '70%',
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                }
            }
        });

        const trendCtx = document.getElementById('trendChart').getContext('2d');
        trendChart = new Chart(trendCtx, {
            type: 'line',
            data: { labels: [], datasets: [] },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: { legend: { display: true } }
            }
        });

        const priorityCtx = document.getElementById('priorityChart').getContext('2d');
        priorityChart = new Chart(priorityCtx, {
            type: 'bar',
            data: { labels: [], datasets: [] },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: { legend: { display: false } }
            }
        });

        function showAddTaskModal() {
            document.getElementById('addTaskModal').classList.remove('hidden');
            updateAreaDropdown();
        }

        function hideAddTaskModal() {
            document.getElementById('addTaskModal').classList.add('hidden');
            document.getElementById('task-name').value = '';
        }

        function addTask() {
            const name = document.getElementById('task-name').value;
            const priority = document.getElementById('task-priority').value;
            const date = document.getElementById('task-date').value;
            const areaId = document.getElementById('task-area').value;
            const subsection = document.getElementById('task-subsection').value;

            if (!name) {
                alert('Please enter a task name');
                return;
            }

            tasks.push({
                id: Date.now(),
                name,
                priority,
                date,
                areaId: areaId ? parseInt(areaId) : null,
                subsection: subsection || null,
                completed: false,
                createdAt: new Date().toISOString()
            });

            localStorage.setItem('tasks', JSON.stringify(tasks));
            hideAddTaskModal();
            render();
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                task.completedAt = task.completed ? new Date().toISOString() : null;
                localStorage.setItem('tasks', JSON.stringify(tasks));
                render();
            }
        }

        function deleteTask(id) {
            if (!confirm('Delete this task?')) return;
            tasks = tasks.filter(t => t.id !== id);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            render();
        }

        function setView(view) {
            currentView = view;
            selectedDate = null; // Clear date filter when switching views
            document.getElementById('selected-date-info').classList.add('hidden');
            document.getElementById('btn-today').className = 'px-4 py-2 rounded-lg font-medium ' + (view === 'today' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700');
            document.getElementById('btn-week').className = 'px-4 py-2 rounded-lg font-medium ' + (view === 'week' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700');
            document.getElementById('btn-month').className = 'px-4 py-2 rounded-lg font-medium ' + (view === 'month' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700');
            render();
        }

        function getFilteredTasks() {
            const now = new Date();
            const cutoff = new Date();
            const todayStr = now.toISOString().split('T')[0];
            
            if (currentView === 'today') {
                return tasks.filter(t => t.date === todayStr);
            } else if (currentView === 'week') {
                cutoff.setDate(now.getDate() - 7);
                return tasks.filter(t => new Date(t.date) >= cutoff);
            } else {
                cutoff.setMonth(now.getMonth() - 1);
                return tasks.filter(t => new Date(t.date) >= cutoff);
            }
        }

        function getPriorityColor(priority) {
            if (priority === 'HIGH') return 'bg-red-500';
            if (priority === 'MEDIUM') return 'bg-orange-400';
            return 'bg-green-500';
        }

        function updateCharts() {
            const filtered = getFilteredTasks();
            const completed = filtered.filter(t => t.completed).length;
            const total = filtered.length;
            const pending = total - completed;
            
            const completedPercent = total > 0 ? Math.round((completed / total) * 100) : 0;
            const pendingPercent = total > 0 ? Math.round((pending / total) * 100) : 0;

            // Update progress chart
            progressChart.data.datasets[0].data = [completedPercent, 0, pendingPercent];
            progressChart.update();

            // Update stats
            document.getElementById('stats').innerHTML = `
                <div class="bg-cyan-50 p-4 rounded-lg">
                    <div class="text-3xl font-bold text-cyan-600">${completedPercent}%</div>
                    <div class="text-sm text-gray-600">Completed</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg">
                    <div class="text-3xl font-bold text-red-600">${total}</div>
                    <div class="text-sm text-gray-600">Total Tasks</div>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <div class="text-3xl font-bold text-yellow-600">${pending}</div>
                    <div class="text-sm text-gray-600">Pending</div>
                </div>
            `;

            // Trend chart - completion over days
            const dateMap = {};
            filtered.forEach(task => {
                if (!dateMap[task.date]) {
                    dateMap[task.date] = { completed: 0, total: 0 };
                }
                dateMap[task.date].total++;
                if (task.completed) dateMap[task.date].completed++;
            });

            const dates = Object.keys(dateMap).sort();
            const completionRates = dates.map(d => {
                const data = dateMap[d];
                return data.total > 0 ? Math.round((data.completed / data.total) * 100) : 0;
            });

            trendChart.data.labels = dates;
            trendChart.data.datasets = [{
                label: 'Completion Rate (%)',
                data: completionRates,
                borderColor: '#3b82f6',
                backgroundColor: '#3b82f633',
                tension: 0.3,
                fill: true
            }];
            trendChart.update();

            // Priority distribution
            const priorityCount = { HIGH: 0, MEDIUM: 0, LOW: 0 };
            filtered.forEach(task => {
                priorityCount[task.priority]++;
            });

            priorityChart.data.labels = ['High', 'Medium', 'Low'];
            priorityChart.data.datasets = [{
                data: [priorityCount.HIGH, priorityCount.MEDIUM, priorityCount.LOW],
                backgroundColor: ['#ef4444', '#f59e0b', '#10b981']
            }];
            priorityChart.update();
        }

        async function getAIFeedback() {
            const btn = document.getElementById('ai-btn');
            btn.disabled = true;
            btn.textContent = 'Analyzing...';

            const filtered = getFilteredTasks();
            const completed = filtered.filter(t => t.completed).length;
            const high = filtered.filter(t => t.priority === 'HIGH').length;
            const highCompleted = filtered.filter(t => t.priority === 'HIGH' && t.completed).length;

            const summary = {
                period: currentView,
                totalTasks: filtered.length,
                completedTasks: completed,
                completionRate: filtered.length > 0 ? Math.round((completed / filtered.length) * 100) : 0,
                highPriorityTasks: high,
                highPriorityCompleted: highCompleted,
                pendingTasks: filtered.length - completed
            };

            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [{
                            role: "user",
                            content: `Analyze this productivity data and provide encouraging, actionable feedback:\n\n${JSON.stringify(summary, null, 2)}\n\nProvide: 1) Overall productivity assessment 2) Wins to celebrate 3) Areas for improvement 4) 2-3 specific recommendations 5) Motivational message. Be concise and encouraging.`
                        }]
                    })
                });

                const data = await response.json();
                const feedback = data.content.map(item => item.text || '').join('\n');
                document.getElementById('ai-feedback').textContent = feedback;
                document.getElementById('ai-feedback').classList.remove('hidden');
            } catch (error) {
                alert('Unable to get AI feedback. Please try again.');
            }

            btn.disabled = false;
            btn.textContent = 'Get AI Feedback';
        }

        function render() {
            const filtered = getFilteredTasks();
            const available = getAvailableTasksWithDependencies(filtered);
            
            // Update view indicator
            const viewNames = { today: "Today's Tasks", week: "This Week", month: "This Month" };
            document.getElementById('view-indicator').textContent = selectedDate ? '' : `(${viewNames[currentView]})`;
            
            const tasksList = document.getElementById('tasks-list');
            tasksList.innerHTML = available.length > 0 ? available.map(task => {
                const area = task.areaId ? areas.find(a => a.id === task.areaId) : null;
                return `
                <div class="flex items-center justify-between p-4 border-2 rounded-xl hover:bg-gray-50 transition ${task.completed ? 'bg-gray-50 opacity-75' : 'bg-white'}">
                    <div class="flex items-center gap-4 flex-1">
                        <input 
                            type="checkbox" 
                            ${task.completed ? 'checked' : ''} 
                            onchange="toggleTask(${task.id})"
                            class="w-6 h-6 rounded border-gray-300 text-cyan-500 focus:ring-cyan-500 cursor-pointer"
                        >
                        <div class="flex-1">
                            <span class="text-lg ${task.completed ? 'line-through text-gray-500' : 'text-gray-800'}">${task.name}</span>
                            ${area ? `
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full" style="background: ${area.color}22; color: ${area.color}">
                                        <span class="w-2 h-2 rounded-full" style="background: ${area.color}"></span>
                                        ${area.name}
                                    </span>
                                    ${task.subsection ? `<span class="text-xs text-gray-500">‚Ä¢ ${task.subsection}</span>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="px-3 py-1 rounded-full text-white text-sm font-medium ${getPriorityColor(task.priority)}">
                            ${task.priority}
                        </span>
                        <button onclick="deleteTask(${task.id})" class="text-red-500 hover:text-red-700 p-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `}).join('') : `
                <div class="text-center py-12 text-gray-500">
                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                    <p class="text-lg">No tasks for ${currentView}</p>
                    <p class="text-sm">Click "Add Task" to get started!</p>
                </div>
            `;

            // Show blocked tasks count
            const blockedCount = filtered.length - available.length;
            if (blockedCount > 0) {
                tasksList.innerHTML = `
                    <div class="mb-4 p-3 bg-gray-100 border-l-4 border-gray-400 rounded">
                        <p class="text-sm text-gray-700">üîí ${blockedCount} task(s) hidden (waiting for prerequisites to complete)</p>
                    </div>
                ` + tasksList.innerHTML;
            }

            updateCharts();
            renderCalendar();
            renderWeeklyProgress();
        }

        // Initial render
        render();
    </script>
</body>
</html>
        // PWA - Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // PWA - Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install banner
            const installBanner = document.createElement('div');
            installBanner.innerHTML = `
                <div class="fixed bottom-4 left-4 right-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-lg shadow-2xl z-50 flex items-center justify-between">
                    <div class="flex-1">
                        <p class="font-bold mb-1">üì± Install App</p>
                        <p class="text-sm">Add to home screen for quick access!</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="installPWA()" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 transition">
                            Install
                        </button>
                        <button onclick="dismissInstallPrompt()" class="text-white hover:text-gray-200">
                            ‚úï
                        </button>
                    </div>
                </div>
            `;
            installBanner.id = 'install-banner';
            document.body.appendChild(installBanner);
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted install');
                    }
                    deferredPrompt = null;
                    dismissInstallPrompt();
                });
            }
        }

        function dismissInstallPrompt() {
            const banner = document.getElementById('install-banner');
            if (banner) banner.remove();
        }
    </script>
</body>
</html>
